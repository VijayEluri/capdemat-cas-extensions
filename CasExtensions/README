Introduction
============

This project constains the adaptations made to the CAS (Central Authentication
Service) for the CVQ project.
They are aimed to be reused by other CG95 projects that will want to benefit
from the SSO capabilities offered by the CAS project.


Build
=====

Run ant cas-extensions on the command line.
That will produce a cas-extensions-{version}.zip ZIP that contains a JAR file,
some JSP files (and maybe other things in the future).
Unzip this file in the home of the CAS server webapp and that's it.


Post-Install
============

Edit the WEB-INF/web.xml file in the CAS server webapp and enable service
restrictions by adding the value /WEB-INF/approvedServices.xml in the parameter
contextConfigLocation. 

Edit the WEB-INF/approvedServices.xml file and :
   * change the serviceRegistry's class to fr.cg95.sso.cas.CvqServiceRegistry
   * change the value of startDelay property to speed up CAS startup

Edit the WEB-INF/cas-servlet.xml file and point the basename property of the
viewResolver to cg95_view.properties (instead of default_view.properties) and
the defaultThemeName property of the themeResolver to cg95 (instead of
default).

Edit the WEB-INF/deployerConfigContext.xml file and :
   * comment out the default authentication handler
   (SimpleTestUsernamePasswordAuthenticationHandler) and instead add the following : <ref
   bean="ldapHandler"/> 
   * add the following beans definitions at the end of the file :

  <bean id="ldapHandler" class="org.jasig.cas.adaptors.ldap.BindLdapAuthenticationHandler">
    <property name="allowMultipleAccounts">
      <value>false</value>
    </property>
    <property name="maxNumberResults">
      <value>1</value>
    </property>
    <property name="searchBase">
      <value>ou=persons,dc=cg95,dc=fr</value>
    </property>
    <property name="timeout">
      <value>60</value>
    </property>
    <property name="filter">
      <value>uid=%u</value>
    </property>
    <property name="contextSource">
      <ref bean="contextSource"/>
    </property>
  </bean>

  <bean id="contextSource" class="org.springframework.ldap.support.UrlContextSource">
    <property name="ldapUrl">
      <value>ldap://cvq1:389/</value>
    </property>
    <property name="securityAuthentication">
      <value>simple</value>
    </property>
  </bean>


TODO
====
Wait for the CAS team to finish specification of the Single Sign Out and adapt
our installation in consequence.
Wait for the CAS team to finish moving LDAP authentication to core and adapt our
installation in consequence.


